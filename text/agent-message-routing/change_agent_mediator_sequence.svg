<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="670px" preserveAspectRatio="none" style="width:1068px;height:670px;" version="1.1" viewBox="0 0 1068 670" width="1068px" zoomAndPan="magnify"><defs><filter height="300%" id="fjkmc1y3gvbmv" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke: #A80036; stroke-width: 1.0;" x1="66" x2="66" y1="86.2969" y2="402.8906"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="66" x2="66" y1="402.8906" y2="443.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="66" x2="66" y1="443.6953" y2="658.7578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396.5" x2="396.5" y1="86.2969" y2="402.8906"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="396.5" x2="396.5" y1="402.8906" y2="443.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396.5" x2="396.5" y1="443.6953" y2="658.7578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="727.5" x2="727.5" y1="86.2969" y2="402.8906"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="727.5" x2="727.5" y1="402.8906" y2="443.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="727.5" x2="727.5" y1="443.6953" y2="658.7578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1020" x2="1020" y1="86.2969" y2="402.8906"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1020" x2="1020" y1="402.8906" y2="443.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1020" x2="1020" y1="443.6953" y2="658.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="8" y="82.9951">Agents-R-Us (C)</text><ellipse cx="66.5" cy="54" fill="#FEFECE" filter="url(#fjkmc1y3gvbmv)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="54.5" x2="78.5" y1="68" y2="68"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52" x="367.5" y="82.9951">Bob (B)</text><ellipse cx="396.5" cy="13" fill="#FEFECE" filter="url(#fjkmc1y3gvbmv)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M396.5,21 L396.5,48 M383.5,29 L409.5,29 M396.5,48 L383.5,63 M396.5,48 L409.5,63 " fill="none" filter="url(#fjkmc1y3gvbmv)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="670.5" y="82.9951">Agents-4-All (D)</text><ellipse cx="727.5" cy="54" fill="#FEFECE" filter="url(#fjkmc1y3gvbmv)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="715.5" x2="739.5" y1="68" y2="68"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="990" y="82.9951">Alice (A)</text><ellipse cx="1020.5" cy="13" fill="#FEFECE" filter="url(#fjkmc1y3gvbmv)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M1020.5,21 L1020.5,48 M1007.5,29 L1033.5,29 M1020.5,48 L1007.5,63 M1020.5,48 L1033.5,63 " fill="none" filter="url(#fjkmc1y3gvbmv)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#EEEEEE" filter="url(#fjkmc1y3gvbmv)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1053" x="3" y="116.8633"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1056" y1="116.8633" y2="116.8633"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1056" y1="119.8633" y2="119.8633"/><rect fill="#EEEEEE" filter="url(#fjkmc1y3gvbmv)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="218" x="420.5" y="106.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="199" x="426.5" y="122.3638">New Routing Record Setup</text><polygon fill="#A80036" points="715.5,201.9609,725.5,205.9609,715.5,209.9609,719.5,205.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396.5" x2="721.5" y1="205.9609" y2="205.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="403.5" y="178.1958">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="189" x="416.5" y="155.4966">{ route-update-request }/B:D</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="416.5" y="170.6294">updates[ (</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="432.5" y="185.7622">recipient_key: B.verkey@B:A, action: create</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="14" x="416.5" y="200.895">) ]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="727.5" x2="769.5" y1="235.0938" y2="235.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="769.5" x2="769.5" y1="235.0938" y2="248.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="728.5" x2="769.5" y1="248.0938" y2="248.0938"/><polygon fill="#A80036" points="738.5,244.0938,728.5,248.0938,738.5,252.0938,734.5,248.0938" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="734.5" y="230.0278">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="747.5" y="230.0278">routing-records[ D:B ] = [ B.verkey@A:B ]</text><polygon fill="#A80036" points="407.5,273.2266,397.5,277.2266,407.5,281.2266,403.5,277.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="401.5" x2="726.5" y1="277.2266" y2="277.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="413.5" y="272.1606">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="426.5" y="272.1606">{ route-update-response }/D:B</text><rect fill="#EEEEEE" filter="url(#fjkmc1y3gvbmv)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1053" x="3" y="305.793"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1056" y1="305.793" y2="305.793"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1056" y1="308.793" y2="308.793"/><rect fill="#EEEEEE" filter="url(#fjkmc1y3gvbmv)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="184" x="437.5" y="295.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="165" x="443.5" y="311.2935">Advise Relying Parties</text><polygon fill="#A80036" points="1008.5,390.8906,1018.5,394.8906,1008.5,398.8906,1012.5,394.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396.5" x2="1014.5" y1="394.8906" y2="394.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="403.5" y="367.1255">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="416.5" y="344.4263">DIDDoc( id: B.did@B:A,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="432.5" y="359.5591">recipientKeys: [B.verkey@B:A],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="432.5" y="374.6919">routingKeys: [</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="520.5" y="374.6919">D.verkey@D:B</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="9" x="612.5" y="374.6919">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="432.5" y="389.8247">serviceEndpoint:</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="541.5" y="389.8247">D.endpoint</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="615.5" y="389.8247">)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="225" x="431" y="427.1011">This is performed for all relying parties</text><rect fill="#EEEEEE" filter="url(#fjkmc1y3gvbmv)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1053" x="3" y="464.2617"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1056" y1="464.2617" y2="464.2617"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1056" y1="467.2617" y2="467.2617"/><rect fill="#EEEEEE" filter="url(#fjkmc1y3gvbmv)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="264" x="397.5" y="453.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="245" x="403.5" y="469.7622">Existing Routing Record Removal</text><polygon fill="#A80036" points="77.5,549.3594,67.5,553.3594,77.5,557.3594,73.5,553.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="71.5" x2="395.5" y1="553.3594" y2="553.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="83.5" y="525.5942">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="96.5" y="502.895">{ route-update-request }/B:C</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="96.5" y="518.0278">updates[ (</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="112.5" y="533.1606">recipient_key: B.verkey@B:A, action:</text><text fill="#008000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40" x="349.5" y="533.1606">delete</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="14" x="96.5" y="548.2935">) ]</text><polygon fill="#A80036" points="384.5,578.4922,394.5,582.4922,384.5,586.4922,388.5,582.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="66.5" x2="390.5" y1="582.4922" y2="582.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="73.5" y="577.4263">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="86.5" y="577.4263">{ route-update-response }/C:B</text><polygon fill="#A80036" points="738.5,607.625,728.5,611.625,738.5,615.625,734.5,611.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="732.5" x2="1019.5" y1="611.625" y2="611.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="744.5" y="606.5591">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="757.5" y="606.5591">All subsequent messages</text><polygon fill="#A80036" points="407.5,636.7578,397.5,640.7578,407.5,644.7578,403.5,640.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="401.5" x2="726.5" y1="640.7578" y2="640.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="413.5" y="635.6919">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="426.5" y="635.6919">are forwarded through Agents-4-All</text><!--
@startuml
autonumber
hide footbox

entity "Agents-R-Us (C)" as Charles
actor "Bob (B)" as Bob
entity "Agents-4-All (D)" as Delta
actor "Alice (A)" as Alice

== New Routing Record Setup ==

Bob -> Delta : { route-update-request }/B:D\nupdates[ (\n    recipient_key: B.verkey@B:A, action: create\n) ]
Delta -> Delta : routing-records[ D:B ] = [ B.verkey@A:B ]
Bob <- - Delta : { route-update-response }/D:B

== Advise Relying Parties ==

Bob -> Alice : DIDDoc( id: B.did@B:A,\n    recipientKeys: [B.verkey@B:A],\n    routingKeys: [<color blue>D.verkey@D:B</color>],\n    serviceEndpoint: <color blue>D.endpoint</color> )

... This is performed for all relying parties ...

== Existing Routing Record Removal ==

Bob -> Charles : { route-update-request }/B:C\nupdates[ (\n    recipient_key: B.verkey@B:A, action: <color green>delete</color>\n) ]
Bob <- - Charles : { route-update-response }/C:B

Alice -> Delta : All subsequent messages
Delta -> Bob : are forwarded through Agents-4-All
@enduml

PlantUML version 1.2019.05(Sat Apr 20 16:45:36 UTC 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.7.0_25-b15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>