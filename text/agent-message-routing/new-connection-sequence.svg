<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="609px" preserveAspectRatio="none" style="width:920px;height:609px;" version="1.1" viewBox="0 0 920 609" width="920px" zoomAndPan="magnify"><defs><filter height="300%" id="f1a3nr07k7y3lz" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="38" x2="38" y1="86.2969" y2="597.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="471" x2="471" y1="86.2969" y2="597.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="874.5" x2="874.5" y1="86.2969" y2="597.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="8" y="82.9951">Alice (A)</text><ellipse cx="38.5" cy="13" fill="#FEFECE" filter="url(#f1a3nr07k7y3lz)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M38.5,21 L38.5,48 M25.5,29 L51.5,29 M38.5,48 L25.5,63 M38.5,48 L51.5,63 " fill="none" filter="url(#f1a3nr07k7y3lz)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="413" y="82.9951">Agents-R-Us (C)</text><ellipse cx="471.5" cy="54" fill="#FEFECE" filter="url(#f1a3nr07k7y3lz)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="459.5" x2="483.5" y1="68" y2="68"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52" x="845.5" y="82.9951">Bob (B)</text><ellipse cx="874.5" cy="13" fill="#FEFECE" filter="url(#f1a3nr07k7y3lz)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M874.5,21 L874.5,48 M861.5,29 L887.5,29 M874.5,48 L861.5,63 M874.5,48 L887.5,63 " fill="none" filter="url(#f1a3nr07k7y3lz)" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="862.5,113.4297,872.5,117.4297,862.5,121.4297,866.5,117.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="38.5" x2="868.5" y1="117.4297" y2="117.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="45.5" y="112.3638">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="564" x="58.5" y="112.3638">{ connection-invitation( recipientKeys: [A.invitation_key], serviceEndpoint: A.endpoint ) }</text><rect fill="#EEEEEE" filter="url(#f1a3nr07k7y3lz)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="905.5" x="3" y="145.9961"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="908.5" y1="145.9961" y2="145.9961"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="908.5" y1="148.9961" y2="148.9961"/><rect fill="#EEEEEE" filter="url(#f1a3nr07k7y3lz)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="181" x="365.25" y="135.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="162" x="371.25" y="151.4966">Routing Record Setup</text><polygon fill="#A80036" points="482.5,200.8281,472.5,204.8281,482.5,208.8281,478.5,204.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="476.5" x2="873.5" y1="204.8281" y2="204.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="488.5" y="192.1958">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="501.5" y="184.6294">{ route-update-request }/B:C</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="501.5" y="199.7622">updates[ ( recipient_key:</text><text fill="#008000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="663.5" y="199.7622">B.verkey@B:A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="753.5" y="199.7622">, action:</text><text fill="#008000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="808.5" y="199.7622">create</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="14" x="853.5" y="199.7622">) ]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="471.5" x2="513.5" y1="233.9609" y2="233.9609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="513.5" x2="513.5" y1="233.9609" y2="246.9609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="472.5" x2="513.5" y1="246.9609" y2="246.9609"/><polygon fill="#A80036" points="482.5,242.9609,472.5,246.9609,482.5,250.9609,478.5,246.9609" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="478.5" y="228.895">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="265" x="491.5" y="228.895">routing-records[ C:B ] = [ B.verkey@A:B ]</text><polygon fill="#A80036" points="862.5,272.0938,872.5,276.0938,862.5,280.0938,866.5,276.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="471.5" x2="868.5" y1="276.0938" y2="276.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="478.5" y="271.0278">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="491.5" y="271.0278">{ route-update-response }/C:B</text><rect fill="#EEEEEE" filter="url(#f1a3nr07k7y3lz)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="905.5" x="3" y="304.6602"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="908.5" y1="304.6602" y2="304.6602"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="908.5" y1="307.6602" y2="307.6602"/><rect fill="#EEEEEE" filter="url(#f1a3nr07k7y3lz)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="167" x="372.25" y="294.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="148" x="378.25" y="310.1606">Connection Request</text><polygon fill="#A80036" points="49.5,359.4922,39.5,363.4922,49.5,367.4922,45.5,363.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="43.5" x2="873.5" y1="363.4922" y2="363.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="55.5" y="350.8599">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="290" x="68.5" y="343.2935">{ connection-request( DID: B.did@B:A ) }/B:A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="68.5" y="358.4263">DIDDoc(publicKey:</text><text fill="#008000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="189.5" y="358.4263">B.verkey@B:A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="279.5" y="358.4263">, serviceEndpoint:</text><text fill="#008000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="396.5" y="358.4263">C.endpoint</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="465.5" y="358.4263">)</text><rect fill="#EEEEEE" filter="url(#f1a3nr07k7y3lz)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="905.5" x="3" y="392.0586"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="908.5" y1="392.0586" y2="392.0586"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="908.5" y1="395.0586" y2="395.0586"/><rect fill="#EEEEEE" filter="url(#f1a3nr07k7y3lz)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="178" x="366.75" y="381.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="159" x="372.75" y="397.5591">Connection Response</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="38.5" x2="80.5" y1="450.8906" y2="450.8906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="80.5" x2="80.5" y1="450.8906" y2="463.8906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="39.5" x2="80.5" y1="463.8906" y2="463.8906"/><polygon fill="#A80036" points="49.5,459.8906,39.5,463.8906,49.5,467.8906,45.5,463.8906" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="45.5" y="438.2583">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="334" x="58.5" y="430.6919">pack { connection-response( DID: A.did@A:B ) }/A:B</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="402" x="58.5" y="445.8247">DIDDoc(publicKey: A.verkey@A:B, serviceEndpoint: A.endpoint)</text><polygon fill="#A80036" points="459.5,489.0234,469.5,493.0234,459.5,497.0234,463.5,493.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="38.5" x2="465.5" y1="493.0234" y2="493.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="45.5" y="487.9575">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="58.5" y="487.9575">{ forward( to:</text><text fill="#008000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="147.5" y="487.9575">B.verkey@B:A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="241.5" y="487.9575">msg:connection-response ) }/A:C</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="471.5" x2="513.5" y1="537.2891" y2="537.2891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="513.5" x2="513.5" y1="537.2891" y2="550.2891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="472.5" x2="513.5" y1="550.2891" y2="550.2891"/><polygon fill="#A80036" points="482.5,546.2891,472.5,550.2891,482.5,554.2891,478.5,550.2891" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="478.5" y="524.6567">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="491.5" y="517.0903">Look up routing</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="491.5" y="532.2231">routing-records[</text><text fill="#008000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="598.5" y="532.2231">B.verkey@B:A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="57" x="692.5" y="532.2231">] =&gt; C:B</text><polygon fill="#A80036" points="862.5,575.4219,872.5,579.4219,862.5,583.4219,866.5,579.4219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="471.5" x2="868.5" y1="579.4219" y2="579.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="478.5" y="574.356">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="491.5" y="574.356">{ connection-response }/C:B</text><!--
@startuml
autonumber
hide footbox

actor "Alice (A)" as Alice
entity "Agents-R-Us (C)" as aru
actor "Bob (B)" as Bob

Bob <- Alice : { connection-invitation( recipientKeys: [A.invitation_key], serviceEndpoint: A.endpoint ) }

== Routing Record Setup ==

Bob -> aru : { route-update-request }/B:C\nupdates[ ( recipient_key: <color green>B.verkey@B:A</color>, action: <color green>create</color> ) ]
aru -> aru : routing-records[ C:B ] = [ B.verkey@A:B ]
Bob <- - aru : { route-update-response }/C:B

== Connection Request ==

Bob -> Alice :  { connection-request( DID: B.did@B:A ) }/B:A\nDIDDoc(publicKey: <color green>B.verkey@B:A</color>, serviceEndpoint: <color green>C.endpoint</color>)

== Connection Response ==

Alice -> Alice : pack { connection-response( DID: A.did@A:B ) }/A:B\nDIDDoc(publicKey: A.verkey@A:B, serviceEndpoint: A.endpoint)
Alice -> aru : { forward( to: <color green>B.verkey@B:A</color> msg:connection-response ) }/A:C
aru -> aru : Look up routing\nrouting-records[ <color green>B.verkey@B:A</color> ] => C:B
Bob <- aru : { connection-response }/C:B
@enduml

PlantUML version 1.2019.05(Sat Apr 20 16:45:36 UTC 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.7.0_25-b15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>