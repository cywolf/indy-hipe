<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="624px" preserveAspectRatio="none" style="width:1054px;height:624px;" version="1.1" viewBox="0 0 1054 624" width="1054px" zoomAndPan="magnify"><defs><filter height="300%" id="fm09dr7lr5k6d" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="38" x2="38" y1="86.2969" y2="612.5547"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="605" x2="605" y1="86.2969" y2="612.5547"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1008.5" x2="1008.5" y1="86.2969" y2="612.5547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="8" y="82.9951">Alice (A)</text><ellipse cx="38.5" cy="13" fill="#FEFECE" filter="url(#fm09dr7lr5k6d)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M38.5,21 L38.5,48 M25.5,29 L51.5,29 M38.5,48 L25.5,63 M38.5,48 L51.5,63 " fill="none" filter="url(#fm09dr7lr5k6d)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="547" y="82.9951">Agents-R-Us (C)</text><ellipse cx="605.5" cy="54" fill="#FEFECE" filter="url(#fm09dr7lr5k6d)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="593.5" x2="617.5" y1="68" y2="68"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52" x="979.5" y="82.9951">Bob (B)</text><ellipse cx="1008.5" cy="13" fill="#FEFECE" filter="url(#fm09dr7lr5k6d)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M1008.5,21 L1008.5,48 M995.5,29 L1021.5,29 M1008.5,48 L995.5,63 M1008.5,48 L1021.5,63 " fill="none" filter="url(#fm09dr7lr5k6d)" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="996.5,113.4297,1006.5,117.4297,996.5,121.4297,1000.5,117.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="38.5" x2="1002.5" y1="117.4297" y2="117.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="45.5" y="112.3638">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="564" x="58.5" y="112.3638">{ connection-invitation( recipientKeys: [A.invitation_key], serviceEndpoint: A.endpoint ) }</text><rect fill="#EEEEEE" filter="url(#fm09dr7lr5k6d)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1039.5" x="3" y="145.9961"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1042.5" y1="145.9961" y2="145.9961"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1042.5" y1="148.9961" y2="148.9961"/><rect fill="#EEEEEE" filter="url(#fm09dr7lr5k6d)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="181" x="432.25" y="135.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="162" x="438.25" y="151.4966">Routing Record Setup</text><polygon fill="#A80036" points="616.5,200.8281,606.5,204.8281,616.5,208.8281,612.5,204.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="610.5" x2="1007.5" y1="204.8281" y2="204.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="622.5" y="192.1958">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="635.5" y="184.6294">{ route-update-request }/B:C</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="635.5" y="199.7622">updates[ ( recipient_key:</text><text fill="#008000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="797.5" y="199.7622">B.verkey@B:A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="887.5" y="199.7622">, action:</text><text fill="#008000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="942.5" y="199.7622">create</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="14" x="987.5" y="199.7622">) ]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="605.5" x2="647.5" y1="233.9609" y2="233.9609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="647.5" x2="647.5" y1="233.9609" y2="246.9609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="606.5" x2="647.5" y1="246.9609" y2="246.9609"/><polygon fill="#A80036" points="616.5,242.9609,606.5,246.9609,616.5,250.9609,612.5,246.9609" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="612.5" y="228.895">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="265" x="625.5" y="228.895">routing-records[ C:B ] = [ B.verkey@A:B ]</text><polygon fill="#A80036" points="996.5,272.0938,1006.5,276.0938,996.5,280.0938,1000.5,276.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="605.5" x2="1002.5" y1="276.0938" y2="276.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="612.5" y="271.0278">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="625.5" y="271.0278">{ route-update-response }/C:B</text><rect fill="#EEEEEE" filter="url(#fm09dr7lr5k6d)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1039.5" x="3" y="304.6602"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1042.5" y1="304.6602" y2="304.6602"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1042.5" y1="307.6602" y2="307.6602"/><rect fill="#EEEEEE" filter="url(#fm09dr7lr5k6d)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="167" x="439.25" y="294.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="148" x="445.25" y="310.1606">Connection Request</text><polygon fill="#A80036" points="49.5,374.625,39.5,378.625,49.5,382.625,45.5,378.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="43.5" x2="1007.5" y1="378.625" y2="378.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="55.5" y="358.4263">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="68.5" y="343.2935">{ connection-request }/B:A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="68.5" y="358.4263">did_doc( id: B.did@B:A, recipientKeys: [</text><text fill="#008000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="318.5" y="358.4263">B.verkey@B:A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="9" x="408.5" y="358.4263">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="84.5" y="373.5591">routingKeys: [</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="172.5" y="373.5591">C.verkey@C:B</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="262.5" y="373.5591">], serviceEndpoint:</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="384.5" y="373.5591">C.endpoint</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="457.5" y="373.5591">)</text><rect fill="#EEEEEE" filter="url(#fm09dr7lr5k6d)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1039.5" x="3" y="407.1914"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1042.5" y1="407.1914" y2="407.1914"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1042.5" y1="410.1914" y2="410.1914"/><rect fill="#EEEEEE" filter="url(#fm09dr7lr5k6d)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="178" x="433.75" y="396.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="159" x="439.75" y="412.6919">Connection Response</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="38.5" x2="80.5" y1="466.0234" y2="466.0234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="80.5" x2="80.5" y1="466.0234" y2="479.0234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="39.5" x2="80.5" y1="479.0234" y2="479.0234"/><polygon fill="#A80036" points="49.5,475.0234,39.5,479.0234,49.5,483.0234,45.5,479.0234" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="45.5" y="453.3911">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="58.5" y="445.8247">pack { connection-response }/A:B</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="540" x="58.5" y="460.9575">did_doc( id: A.did@A:B, recipientKeys: [A.verkey@A:B], serviceEndpoint: A.endpoint )</text><polygon fill="#A80036" points="593.5,504.1563,603.5,508.1563,593.5,512.1563,597.5,508.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="38.5" x2="599.5" y1="508.1563" y2="508.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="45.5" y="503.0903">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="58.5" y="503.0903">{ forward( to:</text><text fill="#008000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="147.5" y="503.0903">B.verkey@B:A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217" x="241.5" y="503.0903">msg: connection-response ) }/A:C</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="605.5" x2="647.5" y1="552.4219" y2="552.4219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="647.5" x2="647.5" y1="552.4219" y2="565.4219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="606.5" x2="647.5" y1="565.4219" y2="565.4219"/><polygon fill="#A80036" points="616.5,561.4219,606.5,565.4219,616.5,569.4219,612.5,565.4219" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="612.5" y="539.7896">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="625.5" y="532.2231">Look up routing</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="625.5" y="547.356">routing-records[</text><text fill="#008000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="732.5" y="547.356">B.verkey@B:A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="57" x="826.5" y="547.356">] =&gt; C:B</text><polygon fill="#A80036" points="996.5,590.5547,1006.5,594.5547,996.5,598.5547,1000.5,594.5547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="605.5" x2="1002.5" y1="594.5547" y2="594.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="612.5" y="589.4888">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="625.5" y="589.4888">{ connection-response }/C:B</text><!--
@startuml
autonumber
hide footbox

actor "Alice (A)" as Alice
entity "Agents-R-Us (C)" as aru
actor "Bob (B)" as Bob

Bob <- Alice : { connection-invitation( recipientKeys: [A.invitation_key], serviceEndpoint: A.endpoint ) }

== Routing Record Setup ==

Bob -> aru : { route-update-request }/B:C\nupdates[ ( recipient_key: <color green>B.verkey@B:A</color>, action: <color green>create</color> ) ]
aru -> aru : routing-records[ C:B ] = [ B.verkey@A:B ]
Bob <- - aru : { route-update-response }/C:B

== Connection Request ==

Bob -> Alice :  { connection-request }/B:A\ndid_doc( id: B.did@B:A, recipientKeys: [<color green>B.verkey@B:A</color>],\n    routingKeys: [<color blue>C.verkey@C:B</color>], serviceEndpoint: <color blue>C.endpoint</color> )

== Connection Response ==

Alice -> Alice : pack { connection-response }/A:B\ndid_doc( id: A.did@A:B, recipientKeys: [A.verkey@A:B], serviceEndpoint: A.endpoint )
Alice -> aru : { forward( to: <color green>B.verkey@B:A</color> msg: connection-response ) }/A:C
aru -> aru : Look up routing\nrouting-records[ <color green>B.verkey@B:A</color> ] => C:B
Bob <- aru : { connection-response }/C:B
@enduml

PlantUML version 1.2019.05(Sat Apr 20 16:45:36 UTC 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.7.0_25-b15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>